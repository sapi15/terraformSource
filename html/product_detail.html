<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìƒí’ˆ ìƒì„¸</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script>
    const API_BASE = 'https://ur3srs1rwi.execute-api.ap-northeast-2.amazonaws.com/default/api'; // âœ… ì‹¤ì œ Gateway URL

    const token = localStorage.getItem('jwt'); // JWT í† í°

    async function fetchProductDetail() {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id');
      if (!id) return alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');

      const res = await fetch(`${API_BASE}/product/${id}`);
      const data = await res.json();
      if (!res.ok) return alert(data.message || 'ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');

      renderProduct(data);
    }

    function renderProduct(product) {
      document.getElementById('title').textContent = product.title;
      document.getElementById('price').textContent = `${Number(product.price).toLocaleString()}ì›`;
      document.getElementById('desc').textContent = product.description;
      document.getElementById('category').textContent = product.category || '-';
      document.getElementById('condition').textContent = product.condition || '-';
      document.getElementById('created_at').textContent = new Date(product.created_at).toISOString().split('T')[0];

      const imgEl = document.getElementById('main-image');
      imgEl.src = product.image_url;
      imgEl.alt = product.title;

      // íƒœê·¸ ë¡œë“œ
      fetchTags(product.image_url);
    }

    async function fetchTags(imageKey) {
  const keyOnly = imageKey.split("/").slice(-2).join("/");  // ğŸ‘ˆ ìœ„ì¹˜ ì˜®ê¹€

  const res = await fetch(`${API_BASE}/rekognition-tags`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      ...(token && { 'Authorization': `Bearer ${token}` })
    },
    body: JSON.stringify({ image_url: keyOnly })  // ğŸ‘ˆ ì˜¬ë°”ë¥¸ ìœ„ì¹˜
  });

  const data = await res.json();
  const container = document.getElementById('tags');
  container.innerHTML = '';
  (data.labels || []).forEach(tag => {
    const el = document.createElement('span');
    el.textContent = `#${tag}`;
    el.className = 'bg-black text-white px-3 py-1 rounded-full text-xs';
    container.appendChild(el);
  });
}


    document.addEventListener('DOMContentLoaded', fetchProductDetail);
  </script>
</head>
<body class="text-gray-800">

  <!-- ìƒë‹¨ë°” -->
  <div id="header-placeholder"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("header-placeholder").innerHTML = data;
      });
  </script>

<!-- ìƒë‹¨ë°”/script -->
<script>
  fetch("header.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("header-placeholder").innerHTML = data;

      // âœ… í—¤ë”ê°€ ë“¤ì–´ê°„ ë‹¤ìŒì— ìš”ì†Œë“¤ ì ‘ê·¼í•´ì•¼ í•¨
      const username = localStorage.getItem("username");
      const token = localStorage.getItem("token");

      const userInfo = document.getElementById("user-info");
      const myshopLink = document.getElementById("myshop-link");
      const logoutLink = document.getElementById("logout-link");
      const loginLink = document.getElementById("login-link");
      const signupLink = document.getElementById("signup-link");

      if (token && username) {
        userInfo.textContent = `ğŸ‘¤ ${username}ë‹˜`;
        myshopLink?.classList.remove("hidden");
        logoutLink?.classList.remove("hidden");
        loginLink?.classList.add("hidden");
        signupLink?.classList.add("hidden");
      }

      logoutLink?.addEventListener("click", function (e) {
        e.preventDefault();
        localStorage.removeItem("token");
        localStorage.removeItem("username");
        location.href = "index.html";
      });
    });
</script>

</script>
<!-- âœ… ìƒí’ˆ ìƒì„¸ -->
<div class="max-w-5xl mx-auto p-4 grid grid-cols-1 md:grid-cols-2 gap-10">
  <!-- ì´ë¯¸ì§€ -->
  <div>
    <img id="main-image" src="" alt="ìƒí’ˆ ì´ë¯¸ì§€" class="w-full rounded" />
  </div>

  <!-- ìƒí’ˆ ì •ë³´ -->
  <div class="space-y-4">
    <div class="text-sm text-gray-500">ì¦‰ì‹œ êµ¬ë§¤ê°€</div>
    <div class="text-3xl font-bold text-black" id="price">-</div>
    <h1 class="text-lg font-semibold leading-tight" id="title">-</h1>

    <div class="flex flex-wrap gap-2 mt-2" id="tags"></div>
    <p class="text-sm text-gray-500" id="desc">-</p>

    <div class="grid grid-cols-3 gap-4 text-sm text-gray-700 mt-4">
      <div>
        <div class="text-gray-400">ì¹´í…Œê³ ë¦¬</div>
        <div id="category">-</div>
      </div>
      <div>
        <div class="text-gray-400">ìƒíƒœ</div>
        <div id="condition">-</div>
      </div>
      <div>
        <div class="text-gray-400">ë“±ë¡ì¼</div>
        <div id="created_at">-</div>
      </div>
    </div>

    <div class="flex items-center gap-2 mt-4">
      <button class="flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded font-semibold">êµ¬ë§¤í•˜ê¸°</button>
      <button class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded font-semibold">ì±„íŒ…í•˜ê¸°</button>
    </div>
  </div>
</div>

<!-- í‘¸í„° ìë¦¬ -->
<div id="footer-placeholder"></div>

<script>
  fetch("footer.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("footer-placeholder").innerHTML = data;
    });
</script>

</body>
</html>
